/**
 * created 07/23/2013
 * 
 * @author arakovsky
 * @see http://livedocs.dojotoolkit.org/util/doh
 * @description unit test for module "gjax/mvc/EnhancedStatefulArray"
 * 
 * @generated by TemplateWizard, v.2013/01/03 //do not remove this comment please
 */
define([
	"doh",
	"gjax/mvc/EnhancedStatefulArray",
	"gjax/mvc/EnhancedStateful",
	"gjax/mvc/ModelRefController",
	"dojo/Stateful"
], function(doh, EnhancedStatefulArray, EnhancedStateful, ModelRefController, Stateful) {

	var data = [
		{
			b : [
				{
					c : 5
				},
				{
					c : 6
				}
			]
		},
		{
			b : [
				{
					c : 7
				},
				{
					c : 8
				}
			]
		}
	];

	// test object
	var testObject = {
		"Instance of" : function() {
			var a = new EnhancedStatefulArray([]);
			doh.t(a.isInstanceOf(Stateful), "Enhanced should be instance of Stateful");
			doh.t(a.isInstanceOf(EnhancedStateful), "Enhanced should be instance of EnhancedStateful");
		},
		"Test nested watch" : function() {
			var testResult = new doh.Deferred(/*canceller*/);
			var modelController = new ModelRefController();
			modelController.loadModelFromData(data);
			modelController.watch(function(prop, oldVal, newVal) {
				if (prop == "1.b.0.c" && newVal == 1) {
					testResult.resolve();
				} else {
					testResult.reject("Unexpected result");
				}
			});
			modelController.model[1].b[0].set("c", 1);
			return testResult;
		},
		"Test nested watch after splice" : function() {
			var testResult = new doh.Deferred(/*canceller*/);
			var modelController = new ModelRefController();
			modelController.loadModelFromData(data);

			var stateful = modelController.model[1];
			modelController.model.splice(0, 1);

			modelController.watch(function(prop, oldVal, newVal) {
				if (prop == "0.b.0.c" && newVal == 1) {
					testResult.resolve();
				} else {
					testResult.reject("Unexpected result");
				}
			});

			stateful.b[0].set("c", 1);
			return testResult;
		},
		"Test nested watch after new items" : function() {
			var testResult = new doh.Deferred(/*canceller*/);
			var modelController = new ModelRefController();
			modelController.loadModelFromData(data);

			var b = new EnhancedStatefulArray([
				new EnhancedStateful({
					c : 9
				}),
				new EnhancedStateful({
					c : 10
				})
			]);

			modelController.model.push(new EnhancedStateful({
				b : b
			}));
			b.unshift(new EnhancedStateful({
				c : 11
			}));

			modelController.watch(function(prop, oldVal, newVal) {
				if (prop == "2.b.0.c" && newVal == 1 && oldVal == 11) {
					testResult.resolve();
				} else {
					testResult.reject("Unexpected result");
				}
			});

			modelController.model[2].b[0].set("c", 1);
			return testResult;
		}
	};

	doh.register("gjax/mvc/EnhancedStatefulArray", testObject);

});
