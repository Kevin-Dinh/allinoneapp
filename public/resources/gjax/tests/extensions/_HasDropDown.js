/**
 * created 03/14/2013
 *
 * @author arakovsky
 *
 * @description unit test for module "gjax/extensions/validationTextBox"
 *
 * @generated by TemplateWizard, v.2012/11/21 //do not remove this comment please
 * @see http://livedocs.dojotoolkit.org/util/doh
 */
define([
	"dojo/ready",
	"doh",
	"dijit/registry",
	"dojo/Deferred",
	"dojo/store/Memory",
	"dojo/on",
	//TESTED LIB
	"gjax/extensions/_HasDropDown",
	"dijit/form/FilteringSelect",
	"dojo/parser" 
], function(ready, doh, registry, Deferred, Memory, on) {

	var testObject = {
		dropDownWidth : function() {
			var def = new Deferred();
			var fs = registry.byId("fs1");
			// fs.loadDropDown();
			// fs.openDropDown();
			fs.loadAndOpenDropDown();
			on.once(fs, "search", function() {
				try {
					doh.assertEqual("100px", fs.dropDown.domNode.style.width);
				} catch (e) {
					def.reject("Narrow dropdown was not expanded"); //should match width of FS
				}
				fs.closeDropDown();
				fs.set("store", new Memory({
					data : [
						{
							id : 1,
							name : "Long item 1"
						},
						{
							id : 2,
							name : "Very long item 2"
						},
						{
							id : 3,
							name : "Even longer than very long item 3"
						}
					]
				}));
				fs.loadAndOpenDropDown();
				on.once(fs, "search", function() {
					try {
						doh.assertTrue(fs.dropDown.domNode.offsetWidth > 150);
						def.resolve();
					} catch (e) {
						def.reject("Dropdown should now be expanded to width of items");
					}
				});
			});
			return def;
		}
	};

	// --------------------------------------
	doh.register("has-dropdown-expand-popup-width", testObject);

	ready(function() {
		var fs = registry.byId("fs1");
		fs.set("store", new Memory({
			data : [
				{
					id : 1,
					name : "Item 1"
				},
				{
					id : 2,
					name : "Item 2"
				},
				{
					id : 3,
					name : "Item 3"
				}
			]
		}));

		doh.run();
	});
});
